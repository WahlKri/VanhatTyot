<meta charset="utf-8" />
<html>
<head>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.5.2/jquery.min.js"></script>
<!-- <script type="text/javascript" src="jquery.min.js"></script> -->
<script type="text/javascript" src="jquery/js/jquery-1.7.2.js"></script>
<script type="text/javascript" src="jquery-qrcode/jquery.qrcode.min.js"></script>
<!-- <script type="text/javascript" src="../lib/jsqrcode/"></script> -->
</head>
<div id="qrcode"></div>
<body>
<div>
<!-- <img id="qrcode" src="qrcodeTest.png"/> -->
</div>
<div id="qrtable"></div>
<button id="send">Send</button>
<button id="stop">Kill Client</button>
</body>
<script type="text/javascript">
var spwsc = '';
$(document).ready(function() {
        spwsc = new SmartParkingWebSocketClient("ws://localhost:50000");
});

$("#stop").click( function() {
        spwsc.disconnectWebSocket();
});

$("#send").click( function() {
        spwsc.sendData("hello server");
});

SmartParkingWebSocketClient.prototype.messageData = '';

function SmartParkingWebSocketClient(uri) {

    this.serverUri = uri;
    this.ws = new WebSocket(this.serverUri);

    var createQRCode = function (codeData) {
        jQuery("#qrcode").qrcode({
            render : "table",
            text : codeData
        });
    }

    this.ws.onopen = function(evt) {
        console.log("Websocket connection is open");
    }

    this.ws.onclose = function() {
        console.log("Websocket connection is closed");
    }

    this.ws.onerror = function(err) {
        console.log("Websocket error occurs! " + err);
    }

    this.ws.onmessage = function(msg) {
        var data = msg.data;
        console.log("Websocket receiving message from server: " + data);
        if (data) {
            createQRCode(data);
        } else {
            console.log("Websocket get empty data ... thats not ok man!");
        }
    }
};

SmartParkingWebSocketClient.prototype.disconnectWebSocket = function () {
    if (this.ws) {
        this.ws.close();
    }
}

SmartParkingWebSocketClient.prototype.sendData = function (data) {
    if (data && this.ws) {
        this.ws.send(data);
    }
    else {
        console.log("Error no data recieved or WebSocket is not open");
    }
}



// stuff for decoding
// $(document).ready(function() {
//     qrcode.callback = showInfo;
//     $("btnDecode").click(qrCodeDecoder);
// })
</script>
</html>
